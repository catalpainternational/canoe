<ImageWrapper>
    <img
        if="{state.imagePath}"
        alt="{props.alt}"
        class="richtext-image"
        crossorigin="anonymous"
        src="{state.imagePath}"
    />
    <p class="error-message" if="{!state.imagePath}">
        Error: image {props.imageId}, "{props.alt}", is missing.
    </p>

    <script>
        import { MissingImageError, getImageUrl } from "js/RenditionSelector";

        export default {
            state: {
                imagePath: "",
                imageId: "",
            },
            onUpdated(props, state) {
                this.setImagePath(props, state);
            },

            onMounted(props, state) {
                this.setImagePath(props, state);
            },

            setImagePath(props) {
                const { imageId } = props;
                if (this.state.imageId !== imageId) {
                    getImageUrl(imageId).then(imagePath => {
                        this.update({imagePath, imageId});
                    }).catch(error => {
                        if (!(error instanceof MissingImageError)) {
                            throw error;
                        }
                    });
                }
            }
        };
    </script>
</ImageWrapper>
