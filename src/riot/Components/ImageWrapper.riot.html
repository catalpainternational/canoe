<ImageWrapper>
    <img
        if="{state.imagePath}"
        alt="{state.image.alt}"
        class="richtext-image"
        crossorigin="anonymous"
        src="{state.imagePath}"
    />
    <p class="error-message" if="{!state.imagePath}">
        Sorry: image "{state.image.alt}", is missing.
    </p>

    <script>
        import { Asset } from "ts/Implementations/Asset";
        import { getRoute } from "ReduxImpl/Interface";
        import { MissingImageError } from "js/Errors";

        export default {
            state: {
                imagePath: "",
                image: {
                    id: "unknown",
                    alt: "Unknown Image",
                }
            },

            loadImage(image) {
                this.state.image = image;
                const assetEntry = this.page.getImageRenditions(image.id);
                if (assetEntry) {
                    try {
                        this.state.imagePath = Asset.url(assetEntry);
                    } catch (error) {
                        if (error instanceof MissingImageError) {
                            this.state.imagePath = "";
                        }
                    }
                }
            },

            onBeforeUpdate(props, state) {
                if (props.image) {
                    this.loadImage(props.image);
                }
            },

            onBeforeMount(props, state) {
                this.page = getRoute().page;
                if (props.image) {
                    this.loadImage(props.image);
                }
            },
        };
    </script>
</ImageWrapper>
