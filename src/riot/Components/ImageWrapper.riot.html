<ImageWrapper>
    <div if="{state.imageFullScreen}"
        class="modal-background fade"
        onclick="{toggleImageFullScreen}">
    </div>
    <img
        if="{state.imagePath}"
        alt="{state.image.alt}"
        class="richtext-image {state.imageFullScreen ? 'full-screen' : ''}"
        crossorigin="anonymous"
        src="{state.imagePath}"
    />
    <div if="{state.imagePath && !state.imageFullScreen}"
        class="expand-button"
        onclick="{toggleImageFullScreen}">
        <span class="expand-arrows"></span>
    </div>
    <div if="{state.imageFullScreen}"
        class="contract-button"
        onclick="{toggleImageFullScreen}">
        <span class="cross gray"></span>
    </div>
    <p class="error-message" if="{!state.imagePath}">
        Sorry: image "{state.image.alt}", is missing.
    </p>

    <script>
        import { getRoute } from "ReduxImpl/Interface";
        import { getRenditionUrl } from "js/RenditionSelector";
        import { MissingImageError } from "js/Errors";

        export default {
            state: {
                imagePath: "",
                image: {
                    id: "unknown",
                    alt: "Unknown Image",
                },
                imageFullScreen: false,
            },

            loadImage(image) {
                this.state.image = image;
                const asset = this.page.getImageRenditions(image.id);
                if (asset) {
                    try {
                        this.state.imagePath = getRenditionUrl("image", asset.renditions);
                    } catch (error) {
                        if (error instanceof MissingImageError) {
                            this.state.imagePath = "";
                        }
                    }
                }
            },

            onBeforeMount(props, state) {
                this.page = getRoute().page;
                if (props.image) {
                    this.loadImage(props.image);
                }
            },

            toggleImageFullScreen() {
                this.update({ imageFullScreen: !this.state.imageFullScreen });
            },
        };
    </script>
</ImageWrapper>
