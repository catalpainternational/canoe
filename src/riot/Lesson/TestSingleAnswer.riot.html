<TestSingleAnswer>
    <ol>
        <li
            each="{answer in card.answers}"
            class="radio { answerItemClass(answer) }"
            onclick="{() => selectAnswer(answer)}"
        >
            <p>{answer.text}</p>
        </li>
    </ol>
    <button
        if="{ !page.hasExam }"
        class="btn-primary"
        onclick="{ showResults }"
        disabled="{ getAnswer() === undefined }"
    >
        { TRANSLATIONS.checkAnswer() }
    </button>

    <script>
        import { getRoute, getTestAnswer, storeTestAnswer } from "ReduxImpl/Interface";
        function TestSingleAnswer() {
            return {
                state: {
                    haveCheckedAnswers: false,
                    checkCount: 0,
                },
                TRANSLATIONS: {
                    checkAnswer: () => gettext("Check answer"),
                },
                get route() {
                    return getRoute();
                },
                get cardIndex() {
                    return parseInt(this.route.riotHash[1]) - 1;
                },
                get page() {
                    return this.route.page;
                },
                get card() {
                    return this.page.examCards 
                        ? this.page.examCards[this.cardIndex]
                        : this.page.cards[this.cardIndex];
                },

                getAnswer() {
                    return getTestAnswer(
                        this.page.id,
                        this.card.id
                    );
                },
                setAnswer(answer) {
                    storeTestAnswer(
                        this.page.id,
                        this.card.id,
                        answer
                    )
                },

                answerItemClass(answer) {
                    const selected = this.getAnswer();
                    if (selected !== undefined && selected.text === answer.text) {
                        // this answer has been selected
                        if (this.page.hasExam || !this.state.haveCheckedAnswers) {
                            // we are in an exam or we have not checked answers yet
                            return "selected-pending";
                        } else {
                            // show selection feedback
                            if (!answer.correct) {
                                return "selected-wrong";
                            } else {
                                return "selected";
                            }
                        }
                    } else {
                        return "";
                    }
                },

                selectAnswer(answer) {
                    this.state.haveCheckedAnswers = false;
                    answer["attempts"] = this.state.checkCount;
                    this.setAnswer(answer);
                },

                showResults() {
                    this.state.checkCount = this.state.checkCount + 1;
                    this.update({
                        haveCheckedAnswers: true
                    });
                    if (this.props.toggleModal) {
                        this.props.toggleModal(true);
                    }
                },
            }
        }

        export default TestSingleAnswer;

    </script>
</TestSingleAnswer>
