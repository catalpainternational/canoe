<TestMultipleAnswer class="answer">
    <h4>Check all that apply</h4>
    <ol>
        <li
            class="{state.visibleAnswers.includes(answer) && answer.correct ? '' : 'wrong'}"
            each="{answer in props.answers}"
            onclick="{() => selectAnswer(answer)}"
        >
            <div>
                <span class="checkbox"></span>
                <span if="{state.visibleAnswers.includes(answer) && answer.correct}" class="checkmark"></span>
                <span if="{state.visibleAnswers.includes(answer) && !answer.correct}" class="cross"></span>
                <span if="{state.hiddenAnswers.includes(answer) && !state.visibleAnswers.includes(answer)}" class="pendingAnswer"></span>
                <p>{answer.text}</p>
            </div>
            <div if="{state.visibleAnswers.includes(answer) && answer.correct}">
                <span class="success"></span>
                <p class="feedback-message text-green-1" translate>Correct answer</p>
            </div>
            <div if="{state.visibleAnswers.includes(answer) && !answer.correct}">
                <span class="warning"></span>
                <p class="feedback-message text-orange-1" translate>Incorrect answer</p>
            </div>
        </li>
    </ol>
    <button
        class="btn-primary"
        onclick="{showResults}"
        disabled="{state.hiddenAnswers.length === 0 && state.visibleAnswers.length === 0}"
        translate
    >Submit</button>
    <script>
        import { dispatchTestAnswerEvent } from "js/Events";

        export default {
            state: {
                hiddenAnswers: [],
                visibleAnswers: []
            },

            submitAnswer(answer) {
                const eventData = {
                    lesson: this.props.lessonName,
                    question: this.props.question,
                    answer: answer.text,
                    isAnswerCorrect: answer.correct
                };
                dispatchTestAnswerEvent(eventData);
            },

            showResults() {
                this.state.visibleAnswers = this.state.visibleAnswers.concat(this.state.hiddenAnswers);
                const hasIncorrectAnswers = this.state.visibleAnswers.includes('false');
                this.state.hiddenAnswers = [];
                console.log(hasIncorrectAnswers)

                this.update();
                this.props.toggleModal(true, {}, hasIncorrectAnswers);
            },

            selectAnswer(answer) {
                if (this.state.visibleAnswers.includes(answer)) {
                    const answerIndex = this.state.visibleAnswers.indexOf(answer);
                    this.state.visibleAnswers.splice(answerIndex, 1);
                } else if (this.state.hiddenAnswers.includes(answer)) {
                    const answerIndex = this.state.hiddenAnswers.indexOf(answer);
                    this.state.hiddenAnswers.splice(answerIndex, 1);
                } else {
                    this.state.hiddenAnswers.push(answer);
                }
                this.update();
            },
        }
    </script>
</TestMultipleAnswer>