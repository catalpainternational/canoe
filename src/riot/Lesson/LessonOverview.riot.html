<LessonOverview>
    <LessonObjective
        if="{state.section === OBJECTIVES}"
        module="{OBJECTIVES}"
        nextModule="{CONTENT}"
        lesson="{props.lesson}"
    ></LessonObjective>
    <LessonContent
        if="{state.section === CONTENT}"
        module="{CONTENT}"
        nextModule="{TEST}"
        lesson="{props.lesson}"
    ></LessonContent>
    <LessonTest
        if="{state.section === TEST}"
        module="{TEST}"
        lesson="{props.lesson}"
    >
    </LessonTest>
    <LessonPage if="{!state.section}" lesson="{props.lesson}"></LessonPage>

    <script>
        import { getRoute } from "ReduxImpl/Interface";

        import LessonObjective from "RiotTags/Lesson/LessonObjective.riot.html";
        import LessonContent from "RiotTags/Lesson/LessonContent.riot.html";
        import LessonTest from "RiotTags/Lesson/LessonTest.riot.html";
        import LessonPage from "RiotTags/WagtailPages/LessonPage.riot.html";

        import { getHashPieces } from "js/Routing";

        function readState() {
            const route = getRoute();
            const state = {
                section: route.riotHash.split(":")[0],
            };
            return state;
        }
        function LessonOverview() { return {
            state: {
                ...readState(),
            },

            OBJECTIVES: "objectives",
            CONTENT: "content",
            TEST: "test",

            onBeforeMount(props, state) {
                state.lessonReady = props.lesson.ready;
            },

            storeListener(previousStoreState, storeState) {
                const newState = readState();
                if (!this.state.lessonReady && this.props.lesson.ready
                    || this.state.section !== newState.section) {
                    this.update(newState);
                }
            }
        }}

        LessonOverview.components = {
            lessonobjective: LessonObjective,
            lessoncontent: LessonContent,
            lessontest: LessonTest,
            lessonpage: LessonPage,
        };

        export default LessonOverview;

    </script>
</LessonOverview>
