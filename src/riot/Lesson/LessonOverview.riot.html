<LessonOverview>
    <LessonObjective
        if="{state.section === OBJECTIVES}"
        module="{OBJECTIVES}"
        nextModule="{CONTENT}"
        lesson="{props.lesson}"
    ></LessonObjective>
    <LessonContent
        if="{state.section === CONTENT}"
        module="{CONTENT}"
        nextModule="{TEST}"
        lesson="{props.lesson}"
    ></LessonContent>
    <LessonTest
        if="{state.section === TEST}"
        module="{TEST}"
        lesson="{props.lesson}"
    >
    </LessonTest>
    <LessonPage if="{!state.section}"></LessonPage>

    <script>
        import { getRoute } from "ReduxImpl/Interface";

        import LessonObjective from "RiotTags/Lesson/LessonObjective.riot.html";
        import LessonContent from "RiotTags/Lesson/LessonContent.riot.html";
        import LessonTest from "RiotTags/Lesson/LessonTest.riot.html";
        import LessonPage from "RiotTags/WagtailPages/LessonPage.riot.html";

        import { getHashPieces } from "js/Routing";

        function readState() {
            const route = getRoute();
            // TODO update this when we get the real data from wagtail
            const cards = mapCards(route.page.objective, 'objectives')
                .concat(mapCards(route.page.content, 'content'))
                .concat(mapCards(route.page.test, 'test'))
                .map((it, index) => ({ index, ...it }));

            route.page.data.cards = cards;

            const state = {
                section: route.riotHash[0],
            };
            return state;
        }

        function mapCards(dataObj, type) {
            return dataObj.cards.map(it => ({ type, ...it }));
        }

        function LessonOverview() { return {

            OBJECTIVES: "objectives",
            CONTENT: "content",
            TEST: "test",

            onBeforeMount(props, state) {
            },
            onBeforeUpdate(props, state) {
                this.state = {
                    ...readState(),
                }
            },

        }}

        LessonOverview.components = {
            lessonobjective: LessonObjective,
            lessoncontent: LessonContent,
            lessontest: LessonTest,
            lessonpage: LessonPage,
        };

        export default LessonOverview;

    </script>
</LessonOverview>
