<ExamResults>
    <template if="{state.passedExam !== null}">
        <div class="congratulations-container">
            <template if="{state.passedExam || props.examType === 'prelearning'}">
                <span class="superman-success"></span>
                <h2>{ TRANSLATIONS.success() }</h2>
                <h3>{ TRANSLATIONS.completed() }</h3>
                <p>{ passedExamMessage() }</p>
                <button class="btn-primary" onclick="{goToAllCourses}">
                    { TRANSLATIONS.back() }
                </button>
                <button class="btn-secondary" onclick="{goToResources}">
                    { TRANSLATIONS.resources() }
                </button>
            </template>
            <template if="{!state.passedExam && props.examType !== 'prelearning'}">
                <div>
                    <span class="incorrect-cross"></span>
                    <h2>{ TRANSLATIONS.notQuite() }</h2>
                    <p>{ failedExamMessage() }</p>
                </div>
                <button class="btn-primary" onclick="{goToCourseExam}">
                    { TRANSLATIONS.retake() }
                </button>
                <button class="btn-secondary" onclick="{goToCourseOverview}">
                    { TRANSLATIONS.backCourse() }
                </button>
            </template>
        </div>
    </template>
    <script>
        import { markExamAsComplete } from "js/CompletionInterface";
        import ExamGrader from "js/ExamGrader";

        export default {
            state: {
                passedExam: null,
            },

            TRANSLATIONS: {
                success: () => gettext("Amazing work!"),
                completed: () => gettext("You've completed the course"),
                back: () => gettext("Back to Courses"),
                resources: () => gettext("View Resources"),
                notQuite: () => gettext("Not quite!"),
                retake: () => gettext("Retake Exam"),
                backCourse: () => gettext("Back to Course"),
            },

            onMounted(props, state) {
                this.calculatePassOrFail();
            },

            calculatePassOrFail() {
                const { course, finalScore, minimumScore } = this.props;

                const passedExam = ExamGrader.saveExamScore(course.slug, finalScore, minimumScore);
                this.update({ passedExam });
            },

            goToCourseOverview() {
                location.hash = `#${this.props.course.loc_hash}`;
            },

            goToAllCourses() {
                location.hash = "#";
            },

            goToResources() {
                location.hash = "#resources";
            },

            goToCourseExam() {
                location.hash = `#${this.props.course.loc_hash}:exam:1`;
            },

            passedExamMessage() {
                // message when user passed the exam
                if (this.props.examType === 'prelearning') {
                    return gettext(
                        "You have completed the pre-learning survey and you can now keep progressing your learning."
                    )
                }

                return gettext(
                    "You passed this exam with a score of %1%. If you want to improve your score you can retake this exam.",
                    this.props.finalScore
                );
            },

            failedExamMessage() {
                // message when user did not pass exam
                return gettext(
                    "You did not pass this assessment because you only scored %1% and you need to reach %2% to pass. You can retake this exam now or later.",
                    this.props.finalScore,
                    this.props.minimumScore
                );
            },
        };
    </script>
</ExamResults>
