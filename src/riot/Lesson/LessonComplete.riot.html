<LessonComplete>
    <div class="congratulations-container">
        <span class="superman-success"></span>
        <template if="{!isCourseComplete()}">
            <div>
                <h2>{ TRANSLATIONS.congrats() }</h2>
                <p>{ lessonCompleteMessage() }</p>
            </div>
            <button class="btn-primary" onclick="{goToCourseOverview}">
                { TRANSLATIONS.next() }
                <span class="chevron"></span>
            </button>
        </template>
        <template if="{isCourseComplete()}">
            <div>
                <h2>{ TRANSLATIONS.good() }</h2>
                <p>{ lessonCompleteMessage() }</p>
                <p if="{ courseHasExam() }">{ takeCourseExamMessage() }</p>
            </div>
            <button if="{courseHasExam() && isPrelearningExam()}" class="btn-primary" onclick="{goToCourseExam}">
                { TRANSLATIONS.survey() }
                <span class="chevron"></span>
            </button>
            <button if="{courseHasExam() && !isPrelearningExam()}" class="btn-primary" onclick="{goToCourseExam}">
                { TRANSLATIONS.exam() }
                <span class="chevron"></span>
            </button>
            <a href="#{state.lesson.course.loc_hash}">{ TRANSLATIONS.course() }</a>
        </template>
    </div>
    <script>
        import { getRoute } from "ReduxImpl/Interface";

        export default {

            onBeforeMount(props, state) {
                this.state.lesson = getRoute().page;
            },

            TRANSLATIONS: {
                congrats: () => gettext("Congratulations!"),
                next: () => gettext("Next Lesson"),
                good: () => gettext("Good job!"),
                exam: () => gettext("Take Exam"),
                survey: () => gettext("Take Survey"),
                course: () => gettext("Back to Course"),
            },

            courseHasExam() {
                return this.state.lesson.course.hasExam;
            },

            isPrelearningExam() {
                return this.state.lesson.course.data.exam_type === 'prelearning';
            },

            isCourseComplete() {
                return this.state.lesson.course.numberOfLessons
                    === this.state.lesson.course.numberOfFinishedLessons;
            },

            goToCourseOverview() {
                location.hash = this.state.lesson.course.loc_hash;
            },

            goToCourseExam() {
                location.hash = `${this.state.lesson.course.loc_hash}:exam`;
            },

            lessonCompleteMessage() {
                // message on completion of a lesson %1 is replaced by the lesson title
                return gettext('You just completed the lesson "%1"', this.state.lesson.title);
            },

            takeCourseExamMessage() {
                // message on completion of lesson and prompt to take course exam
                if (this.isPrelearningExam()) {
                    return gettext(
                        'Take the pre-learning survey to complete the course "%1"',
                        this.state.lesson.course.title
                    )
                }

                return gettext(
                    'Take the exam now to complete the course "%1"',
                    this.state.lesson.course.title
                );
            },
        };
    </script>
</LessonComplete>
