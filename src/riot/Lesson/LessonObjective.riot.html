<LessonObjective>
    <div class="objective background-blue-1" if="{state.cardIdx < props.objective.cards.length}">
        <div class="carousel-card">
            <span class="plant"></span>
            <h3 translate>Objectives</h3>
            <p class="center-objective">{props.objective.cards[state.cardIdx].description}</p>
            <div class="bottom-buttons">
                <div>
                    <a if="{state.cardIdx > 0}" class="arrow-gray" onclick="{goBack}"></a>
                </div>
                <div>
                    <button class="btn-primary" onclick="{nextObjectiveCard}" if="{state.cardIdx < props.objective.cards.length - 1}" translate>Next</button>
                    <button class="btn-primary" onclick="{completeObjectiveModal}" if="{state.cardIdx === props.objective.cards.length - 1}" translate>Finish</button>
                </div>
            </div>
            <p class="card-number">{state.cardIdx + 1}<span translate> of </span>{props.objective.cards.length}</p>
        </div>
    </div>
    <LessonModuleComplete if="{state.cardIdx === props.objective.cards.length}" lessonId="{props.lesson.id}" module="{props.module}" nextModule="{props.nextModule}" title="{props.title}" background="{props.course.colour}"></LessonModuleComplete>

    <script>
        import LessonModuleComplete from 'RiotTags/Lesson/LessonModuleComplete.riot.html';

        import { getLessonCardIdx, getLessonModuleHash } from 'js/Routing';
        import { setComplete } from 'Actions/completion';

        export default {
            state: {
                cardIdx: 0,
            },

            components: {
                'lessonmodulecomplete': LessonModuleComplete,
            },

            onBeforeMount(props, state) {
                state.cardIdx = getLessonCardIdx();
                window.addEventListener('hashchange', this.hashChanged);
            },

            onBeforeUnmount(props, state) {
                window.removeEventListener('hashchange', this.hashChanged);
            },

            hashChanged() {
                this.update({
                    cardIdx: getLessonCardIdx(),
                });
            },

            goBack() {
                window.history.back();
            },

            nextObjectiveCard() {
                window.scroll(0,0);
                location.hash = getLessonModuleHash(this.props.lesson.id, this.props.module, this.state.cardIdx);

            },

            completeObjectiveModal() {
                setComplete(this.props.course.slug, this.props.lesson.slug, this.props.module);
                location.hash = getLessonModuleHash(this.props.lesson.id, this.props.module, this.state.cardIdx);
            },
        }
    </script>
</LessonObjective>
