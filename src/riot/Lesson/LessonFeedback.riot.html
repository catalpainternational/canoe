<LessonFeedback>
    <LessonFrame>
        <template if="{!state.madeFeedbackDecision}">
            <div class="feedback-icon">
                <div class="sun"></div>
                <h2 translate>FEEDBACK</h2>
            </div>
            <div class="feedback-container">
                <h3 translate>Are you enjoying this lesson?</h3>
                <div class="feedback-buttons">
                    <button class="feedback" onclick="{clickedThisLessonIsFine}">
                        <span class="neutral-smiley"></span>
                    </button>
                    <button class="feedback" onclick="{clickedThisLessonIsGood}">
                        <span class="smiling-smiley"></span>
                    </button>
                    <button class="feedback" onclick="{clickedThisLessonIsGreat}">
                        <span class="thrilled-smiley"></span>
                    </button>
                </div>
                <p translate>
                    Let us know what you think of this lesson. We value your feedback and treat all
                    feedback as confidential.
                </p>
            </div>
            <button class="btn-primary no-thanks" onclick="{clickedNoThanks}" translate>
                No thanks
            </button>
        </template>
        <template if="{state.madeFeedbackDecision}">
            <div class="feedback-icon">
                <div class="sun"></div>
                <h2 translate>FEEDBACK</h2>
            </div>
            <div class="thank-you-container">
                <h3 translate>Successfully sent!</h3>
                <div class="correct-flag"></div>
                <p translate>
                    Thanks for your feedback. Your opinion matters to us and we are working hard to continually improve your experience
                </p>
            </div>
            <button class="btn-primary thank-you-container" onclick="{clickedContinue}" translate>
                Continue
            </button>
        </template>
    </LessonFrame>
    <script>
        import LessonFrame from "RiotTags/Components/LessonFrame.riot.html";
        import { logLessonFeedback } from "js/GoogleAnalytics";
        import { parseURLHash } from "js/Routing";

        export default {
            components: {
                lessonframe: LessonFrame,
            },

            state: {
                madeFeedbackDecision: false,
            },

            clickedThisLessonIsFine() {
                this.sendFeedback("bad");
                this.update({
                    madeFeedbackDecision: true,
                });
            },

            clickedThisLessonIsGood() {
                this.sendFeedback("fine");
                this.update({
                    madeFeedbackDecision: true,
                });
            },

            clickedThisLessonIsGreat() {
                this.sendFeedback("great");
                this.update({
                    madeFeedbackDecision: true,
                });
            },

            clickedNoThanks() {
                this.goToSectionEnd();
            },

            clickedContinue() {
                this.goToSectionEnd();
            },

            goToSectionEnd() {
                const [lessonNumber, section, cardNumber] = parseURLHash();
                const nextCardNumber = new Number(cardNumber) + 1;
                window.location.hash = `#${lessonNumber}/${section}/${nextCardNumber}`;
            },

            sendFeedback(feedbackString) {
                const lesson = this.props.lessonName;
                const feedback = feedbackString;

                logLessonFeedback({
                    lesson,
                    feedback,
                });
            },
        };
    </script>
</LessonFeedback>
