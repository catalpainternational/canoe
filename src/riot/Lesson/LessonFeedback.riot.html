<LessonFeedback>
    <LessonFrame linkTo="{backToLesson()}">
        <template if="{!state.madeFeedbackDecision}">
            <div class="feedback-icon">
                <div class="sun"></div>
                <h2>{ TRANSLATIONS.feedback() }</h2>
            </div>
            <div class="feedback-container">
                <h3>{ TRANSLATIONS.enjoying_lesson() }</h3>
                <div class="feedback-buttons">
                    <button class="feedback" onclick="{() => clickedThisLessonIs('fine')}">
                        <span class="neutral-smiley"></span>
                    </button>
                    <button class="feedback" onclick="{() => clickedThisLessonIs('good')}">
                        <span class="smiling-smiley"></span>
                    </button>
                    <button class="feedback" onclick="{() => clickedThisLessonIs('great')}">
                        <span class="thrilled-smiley"></span>
                    </button>
                </div>
                <p>{ TRANSLATIONS.give_feedback() }</p>
            </div>
            <button class="btn-primary no-thanks" onclick="{clickedNoThanks}">
                { TRANSLATIONS.no() }
            </button>
        </template>
        <template if="{state.madeFeedbackDecision}">
            <div class="feedback-icon">
                <div class="sun"></div>
                <h2>{ TRANSLATIONS.feedback() }</h2>
            </div>
            <div class="thank-you-container">
                <h3>{ TRANSLATIONS.sent() }</h3>
                <div class="correct-flag"></div>
                <p>{ TRANSLATIONS.feedback_sent() }</p>
            </div>
            <button class="btn-primary thank-you-container" onclick="{clickedContinue}">
                { TRANSLATIONS.continue() }
            </button>
        </template>
    </LessonFrame>
    <script>
        import LessonFrame from "RiotTags/Components/LessonFrame.riot.html";
        import { logLessonFeedback } from "js/GoogleAnalytics";
        import { parseURLHash } from "js/Routing";

        export default {
            TRANSLATIONS: {
                feedback: () => gettext("FEEDBACK"),
                enjoying_lesson: () => gettext("Are you enjoying this lesson?"),
                give_feedback: () =>
                    gettext("We value your feedback and all feedback is confidential."),
                feedback_sent: () =>
                    gettext(
                        "Thanks for your feedback. Your opinion matters to us and we are working hard to improve your experience"
                    ),
                no: () => gettext("No thanks"),
                sent: () => gettext("Successfully sent!"),
                continue: () => gettext("Continue"),
            },
            components: {
                lessonframe: LessonFrame,
            },

            state: {
                madeFeedbackDecision: false,
            },

            clickedThisLessonIs(rating) {
                this.sendFeedback(rating);
                this.update({
                    madeFeedbackDecision: true,
                });
            },

            clickedNoThanks() {
                this.goToSectionEnd();
            },

            clickedContinue() {
                this.goToSectionEnd();
            },

            goToSectionEnd() {
                const [lessonNumber, section, cardNumber] = parseURLHash();
                const nextCardNumber = new Number(cardNumber) + 1;
                window.location.hash = `#${lessonNumber}/${section}/${nextCardNumber}`;
            },

            backToLesson() {
                const [lessonNumber] = parseURLHash();
                return lessonNumber;
            },

            sendFeedback(feedbackString) {
                const lesson = this.props.lessonName;
                const feedback = feedbackString;

                logLessonFeedback({
                    lesson,
                    feedback,
                });
            },
        };
    </script>
</LessonFeedback>
