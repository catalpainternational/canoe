<Test>
    <ImageWrapper
        if="{ card.image }"
        image="{ card.image }"
    ></ImageWrapper>
    <h3>
        <template if="{ isExam }">
            { cardNumber }.&nbsp; 
        </template>
        { card.question }
    </h3>
    <TestSingleAnswer
        if="{ testType === 'single' }"
        toggleModal="{ props.toggleModal }"
    ></TestSingleAnswer>
    <TestMultipleAnswer
        if="{ testType === 'multiple' }"
        toggleModal="{ props.toggleModal }"
    ></TestMultipleAnswer>
    <script>
        import ImageWrapper from "RiotTags/Components/ImageWrapper.riot.html";
        import TestSingleAnswer from "RiotTags/Lesson/TestSingleAnswer.riot.html";
        import TestMultipleAnswer from "RiotTags/Lesson/TestMultipleAnswer.riot.html";

        import { getRoute } from "ReduxImpl/Interface";

        function Test() {
            return {
                get route() {
                    return getRoute();
                },
                get cardIndex() {
                    return this.cardNumber - 1;
                },
                get cardNumber() {
                    const cardNum = parseInt(this.route.riotHash[1]);
                    return isNaN(cardNum)
                        ? ( this.page.examType === 'prelearning' ? 1 : 'code')
                        : cardNum;
                },
                get page() {
                    return this.route.page;
                },
                get isExam() {
                    return !!this.page.examCards;
                },
                get card() {
                    return this.page.examCards 
                        ? this.page.examCards[this.cardIndex]
                        : this.page.cards[this.cardIndex];
                },
                get testType() {
                    switch(this.card.tag) {
                        case "multipleChoice":
                            return "multiple";
                        default:
                            return "single";
                    }
                },
            };
        };

        Test.components = {
            imagewrapper: ImageWrapper,
            testsingleanswer: TestSingleAnswer,
            testmultipleanswer: TestMultipleAnswer,
        };

        export default Test;
    </script>
</Test>
