<LessonPage>
    <LessonFrame
        if="{lesson.ready}"
        linkTo="{lesson.course.loc_hash}"
    >
        <div class="message-container">
            <h5>{TRANSLATIONS.lesson()}</h5>
            <h3>{lesson.title}</h3>
            <div if="{state.cardImageUrl}" class="lesson-page-image-wrap">
                <img
                    crossorigin="anonymous"
                    src="{state.cardImageUrl}"
                    class="lesson-page-image"
                />
            </div>
            <span if="{!lesson.cardImage}" class="lesson-presentation"></span>
            <p>{lesson.shortDescription}</p>
            <p>{lesson.longDescription}</p>
        </div>
    </LessonFrame>
    <div if="{lesson.ready}" class="bottom-buttons">
        <button class="btn-primary" onclick="{startLesson}">
            { TRANSLATIONS.start() }
        </button>
    </div>

    <script>
        import LessonFrame from "RiotTags/Components/LessonFrame.riot.html";

        import { getRoute } from "ReduxImpl/Interface";

        function LessonPage() { return {
            TRANSLATIONS: {
                lesson: () => gettext("Lesson"),
                lesson_activities: () => gettext("Lesson Activities"),
                start: () => gettext("Start lesson"),
            },

            onBeforeMount(props, state) {
                this.lesson = getRoute().page;
                this.state.cardImageUrl = this.lesson.cardImage
                    ? `${process.env.API_BASE_URL}${this.lesson.cardImage}`
                    : undefined;

            },

            onMounted(props, state) {
                this.disableBlockedLessonModules();
            },

            onUpdated() {
                this.disableBlockedLessonModules();
            },

            startLesson() {
                location.hash = `#${this.lesson.loc_hash}:content:1`;
            },

            backToCoursePage() {
                location.hash = "#" + this.lesson.course.loc_hash;
            },

            disableBlockedLessonModules() {
                const ongoingCards = [...document.getElementsByClassName("ongoing")];

                let sliceFrom = 1;

                const cardsToDisable = ongoingCards.slice(sliceFrom);
                for (const card of cardsToDisable) {
                    card.classList.add("disabled");
                }
            },

            moduleStatus(module) {
                if (this.lesson.isModuleComplete(module)) {
                    return "complete";
                } else {
                    return "not-started";
                }
            },
        }};

        LessonPage.components = {
            lessonframe: LessonFrame,
        };

        export default LessonPage;
    </script>
</LessonPage>
