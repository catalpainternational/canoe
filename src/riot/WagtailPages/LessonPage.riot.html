<LessonPage>
    <TopMenu>
        <a class="arrow-gray top-icon left has-circle" onclick="{backToCoursePage}"></a>
        <h4>{ props.wagtailPage.course.title }</h4>
    </TopMenu>
    <div class="content-wrapper">
        <h3 id="lessonPageTitle">{props.wagtailPage.title}</h3>
        <p>{props.wagtailPage.shortDescription}</p>
        <p if="{props.wagtailPage.longDescription && state.showLongDescription}">
            {props.wagtailPage.longDescription}
        </p>
        <a
            if="{props.wagtailPage.longDescription && state.showLongDescription}"
            onclick="{toggleLessonDescription}"
            >{ TRANSLATIONS.less() }</a
        >
        <a
            if="{props.wagtailPage.longDescription && !state.showLongDescription}"
            onclick="{toggleLessonDescription}"
            >{ TRANSLATIONS.more() }</a
        >
        <div class="activity-swoop">
            <h5 class="section-title">{ TRANSLATIONS.lesson_activities() }</h5>
            <div class="card-container">
                <Card
                    title="1. {props.wagtailPage.objective.title}"
                    link="{props.wagtailPage.id}/{OBJECTIVES}/1"
                    status="{moduleStatus(OBJECTIVES)}"
                    class="objective"
                >
                </Card>

                <Card
                    title="2. {props.wagtailPage.content.title}"
                    link="{props.wagtailPage.id}/{CONTENT}/1"
                    status="{moduleStatus(CONTENT)}"
                    class="content"
                >
                </Card>

                <Card
                    title="3. {props.wagtailPage.test.title}"
                    link="{props.wagtailPage.id}/{TEST}/1"
                    status="{moduleStatus(TEST)}"
                    class="test"
                >
                </Card>
            </div>
        </div>
    </div>

    <script>
        import Card from "RiotTags/Components/Card.riot.html";
        import TopMenu from "RiotTags/Components/TopMenu.riot.html";

        import { isComplete } from "Actions/completion";

        export default {
            state: {
                showLongDescription: false,
                header: null,
                lessonPageTitle: null,
            },

            components: {
                card: Card,
                topmenu: TopMenu,
            },

            TRANSLATIONS: {
                lesson_activities: () => gettext("Lesson Activities"),
                more: () => gettext("See more"),
                less: () => gettext("See less"),
            },

            OBJECTIVES: "objectives",
            CONTENT: "content",
            TEST: "test",

            onMounted(props, state) {
                this.disableBlockedLessonModules();
            },

            onUpdated() {
                this.disableBlockedLessonModules();
            },

            backToCoursePage() {
                location.hash = "#" + this.props.wagtailPage.course.id;
            },

            toggleLessonDescription() {
                this.update({
                    showLongDescription: !this.state.showLongDescription,
                });
            },

            disableBlockedLessonModules() {
                const ongoingCards = [...document.getElementsByClassName("ongoing")];

                const isComingSoon = this.props.wagtailPage.isComingSoon();
                let sliceFrom = 1;

                if (isComingSoon) {
                    sliceFrom = 0;
                }

                const cardsToDisable = ongoingCards.slice(sliceFrom);
                for (const card of cardsToDisable) {
                    card.classList.add("disabled");
                }
            },

            moduleStatus(module) {
                if (
                    isComplete(
                        this.props.wagtailPage.course.slug,
                        this.props.wagtailPage.slug,
                        module
                    )
                ) {
                    return "complete";
                } else {
                    return "not-started";
                }
            },
        };
    </script>
</LessonPage>
