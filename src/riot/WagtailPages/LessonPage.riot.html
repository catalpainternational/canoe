<LessonPage>
    <TopMenu extrastyleclasses="without-swoop">
        <a class="top-icon left has-circle" onclick="{backToCoursePage}">
            <span class="arrow"></span>
        </a>
        <h4>{ props.lesson.title }</h4>
    </TopMenu>
    <div class="content-wrapper">
        <h3 id="lessonPageTitle">{props.lesson.title}</h3>
        <template if="{ props.lesson.ready }">

            <p>{props.lesson.shortDescription}</p>
            <p if="{props.lesson.longDescription && state.showLongDescription}">
                {props.lesson.longDescription}
            </p>
            <a
                if="{props.lesson.longDescription && state.showLongDescription}"
                onclick="{toggleLessonDescription}"
                >{ TRANSLATIONS.less() }</a
            >
            <a
                if="{props.lesson.longDescription && !state.showLongDescription}"
                onclick="{toggleLessonDescription}"
                >{ TRANSLATIONS.more() }</a
            >
            <div class="activity-swoop">
                <h5 class="section-title">{ TRANSLATIONS.lesson_activities() }</h5>
                <div class="card-container">
                    <Card
                        title="1. {props.lesson.objective.title}"
                        link="{props.lesson.loc_hash}:{OBJECTIVES}:1"
                        status="{moduleStatus(OBJECTIVES)}"
                        availability="{props.lesson.isAvailableOffline}"
                        class="objective-stock-image"
                    >
                    </Card>

                    <Card
                        title="2. {props.lesson.content.title}"
                        link="{props.lesson.loc_hash}:{CONTENT}:1"
                        status="{moduleStatus(CONTENT)}"
                        availability="{props.lesson.isAvailableOffline}"
                        class="content-stock-image"
                    >
                    </Card>

                    <Card
                        title="3. {props.lesson.test.title}"
                        link="{props.lesson.loc_hash}:{TEST}:1"
                        status="{moduleStatus(TEST)}"
                        availability="{props.lesson.isAvailableOffline}"
                        class="test-stock-image"
                    >
                    </Card>
                </div>
            </div>
        </template>
    </div>

    <script>
        import Card from "RiotTags/Components/Card.riot.html";
        import TopMenu from "RiotTags/Components/TopMenu.riot.html";

        import { isComplete } from "Actions/completion";

        function LessonPage() { return {
            state: {
                showLongDescription: false,
                header: null,
                lessonPageTitle: null,
            },

            TRANSLATIONS: {
                lesson_activities: () => gettext("Lesson Activities"),
                more: () => gettext("See more"),
                less: () => gettext("See less"),
            },

            OBJECTIVES: "objectives",
            CONTENT: "content",
            TEST: "test",

            onMounted(props, state) {
                this.disableBlockedLessonModules();
            },

            onUpdated() {
                this.disableBlockedLessonModules();
            },

            backToCoursePage() {
                location.hash = "#" + this.props.lesson.course.loc_hash;
            },

            toggleLessonDescription() {
                this.update({
                    showLongDescription: !this.state.showLongDescription,
                });
            },

            disableBlockedLessonModules() {
                const ongoingCards = [...document.getElementsByClassName("ongoing")];

                const isComingSoon = this.props.lesson.isComingSoon();
                let sliceFrom = 1;

                if (isComingSoon) {
                    sliceFrom = 0;
                }

                const cardsToDisable = ongoingCards.slice(sliceFrom);
                for (const card of cardsToDisable) {
                    card.classList.add("disabled");
                }
            },

            moduleStatus(module) {
                if (
                    this.props.lesson.isModuleComplete(
                        module
                    )
                ) {
                    return "complete";
                } else {
                    return "not-started";
                }
            },
        }};

        LessonPage.components = {
            card: Card,
            topmenu: TopMenu,
        };
        
        export default LessonPage;
    </script>
</LessonPage>
